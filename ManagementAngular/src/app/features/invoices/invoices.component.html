<app-menu [search]=true></app-menu>
<div class="container-page">
    <div class="row container-row ">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12 table-container ">
            <div class="container table-responsive py-5 table-container-responsive">
                <div class="title-container">
                    <h1>Fatture.</h1> <i class="fas fa-file-invoice"></i>
                    <div class="button-container-new" style="display: inline-block;">
                        <button onclick="toggleNewLayer()"><a>Nuova Fattura</a></button>
                    </div>
                </div>
                <table class="table">
                    <tr class="tr">
                        <td class="th">Numero</td>
                        <td class="th">Ragione Sociale</td>
                        <td class="th">Data</td>
                        <td class="th">Metodo di Pagamento</td>
                        <td class="th">Totale</td>
                        <td class="th">Azioni</td>
                    </tr>
                    <tr *ngFor="let invoice of invoices; let i = index;" class="tr">
                        <td class="td">{{i+1}}</td>
                        <td class="td">{{invoice.accountholder}}</td>
                        <td class="td">{{invoice.date}}</td>
                        <td class="td">{{invoice.paymentMethod}}</td>
                        <td class="td">{{invoice.tail.finalAmount}}</td>
                        <td class="td">
                            <button onclick="toggleLayer()"><i class="fas fa-edit"></i></button>
                            <button onclick="toggleLayerZoom()"><i class="fas fa-search" (click)="detail(invoice.id)"></i></button>
                            <button onclick="toggleLayerConfirm()"><i class="fas fa-times"></i></button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <button onclick="toggleLayerOverlay()">
            <div id="overlay"></div>
        </button>
    </div>
</div>
<app-footer></app-footer>

<div id="div-edit" style="display: none;">
    <div class="form-container">
        <button id="x-icon" onclick="toggleLayerX()"><i class="fas fa-times"></i></button>
        <h1>Modifica Fattura</h1>
        <form>
            <div class="row">
                <div class="col-4 col-sm-4 col-md-4 col-lg-4 ">
                    <div class="form-group">
                        <label for="codice">Codice</label>
                        <input type="email" class="form-control" placeholder="Codice" required>
                    </div>
                </div>
                <div class="col-8 col-sm-8 col-md-8 col-lg-8">
                    <div class="form-group">
                        <label for="ragione-sociale">Ragione Sociale</label>
                        <input class="form-control" placeholder="Ragione Sociale" required>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-4 col-sm-4 col-md-4 col-lg-4 ">
                    <div class="form-group">
                        <label for="data">Data</label>
                        <input type="email" class="form-control" placeholder="Data" required>
                    </div>
                </div>
                <div class="col-8 col-sm-8 col-md-8 col-lg-8">
                    <div class="form-group">
                        <label for="pagamento">Pagamento</label>
                        <input class="form-control" placeholder="Pagamento" required>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6 col-sm-6 col-md-6 col-lg-6 ">
                    <div class="form-group">
                        <label for="totale">Totale</label>
                        <input type="email" class="form-control" placeholder="Totale">
                    </div>
                </div>

            </div>
            <div class="form-group">
                <button type="submit">Modifica Fattura</button>
            </div>
        </form>
    </div>
</div>

<!--DIV CREA FATTURA-->
<div id="div-new" style="display: none;">
    <div class="form-container">
        <button id="x-icon" onclick="toggleLayerX()"><i class="fas fa-times" ></i></button>
        <button id="x-icon" onclick="toggleLayerX()"> <i class="far fa-save"></i></button>
        <h1>Crea Nuova Fattura</h1>
        <form [formGroup]="invoiceForm" (ngSubmit)="save()">
            <div class="row">
                <div class="col-4 col-sm-4 col-md-4 col-lg-4 ">
                    <div class="form-group">
                        <label for="tail">Sconto Coda</label>
                        <input type="email" class="form-control" placeholder="tail" formControlName="tail">
                    </div>
                </div>
                <div class="col-8 col-sm-8 col-md-8 col-lg-8">
                    <div class="form-group">
                        <label for="Intestatario">Intestatario</label>
                        <input class="form-control" placeholder="Intestatario" formControlName="accountholder">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-4 col-sm-4 col-md-4 col-lg-4 ">
                    <div class="form-group">
                        <label for="data">Data</label>
                        <input type="email" class="form-control" placeholder="Data" required>
                    </div>
                </div>
                <div class="col-8 col-sm-8 col-md-8 col-lg-8">
                    <div class="form-group">
                        <label for="pagamento">Pagamento</label>
                        <input class="form-control" placeholder="Pagamento" required>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-12 col-md-12 col-lg-12" style="margin-bottom: 5vh;">
                <table class="table">
                    <tr class="tr">
                        <td class="th">Items Value</td>
                        <td class="th">Service Value</td>
                        <td class="th">Sconto Riga</td>
                        <td class="th">Sconto %</td>
                        <td class="th">Valore Sconto</td>
                        <td class="th">Sconto Totale</td>
                        <td class="th">Imponibile</td>
                        <td class="th"> Taxed</td>
                        <td class="th">Totale Finale</td>
                    </tr>
                    <tr *ngFor="let item of invoices; let i = index;" class="tr">
                        <td class="td">{{i+1}}</td>
                        <td class="td">{{item.number}}</td>
                        <td class="td">{{item.accountholder}}</td>
                        <td class="td">{{item.date}}</td>
                        <td class="td">{{item.paymentMethod}}</td>
                    </tr>
                </table>
            </div>
            <div class="row">
                <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                    <div class="form-group">
                        <button type="button" style="width: 100%; font-size: 1.5rem;" onclick="addItemDiv()">Seleziona articoli</button>
                    </div>
                </div>
            </div>
            <div *ngFor="let item of rowsTemp" class="row">
                <p>{{item.quantity}}</p>
            </div>

        </form>
    </div>
</div>

<!--DIV SELEZIONA ARTICOLI-->
<div id="div-select" style="display: none;">
    <div class="form-container">
        <button id="x-icon" onclick="toggleLayerXSelect()"><i class="fas fa-times"></i></button>
        <h1 class="m-0 select-article">Seleziona Articoli</h1>
        <form [formGroup]="itemForm">
            <table class="table" style="width: 76%;">
                <tr class="tr">
                    <td class="th">Articolo</td>
                    <td class="th">Quantità</td>
                    <td class="th">Sconto %</td>
                    <td class="th"></td>
                </tr>
                <tr *ngFor="let item of items" class="tr">
                    <td class="td">{{item.description}}</td>
                    <td class="td"><input class=" unset" type="number" placeholder="Quantità"></td>
                    <td class="td"><input class=" unset" type="number" placeholder="Sconto %"></td>
                    <td>
                        <div class="form-group">
                            <button type="submit" class="addItem">Aggiungi</button>
                        </div>
                    </td>
                </tr>
            </table>
            <div class="form-group">
                <button type="submit" class="save-new-invoice">Salva</button>
            </div>
        </form>
    </div>
</div>

<!--DIV SEI SICURO DI VOLER ELIMINARE FATTURA?-->
<div id="div-delete" style="display: none; ">
    <div class="form-container">
        <button id="x-icon" onclick="toggleLayerX()"><i class="fas fa-times" ></i></button>
        <h1>Sei sicuro di voler eliminare la fattura?</h1>
        <br> <br>
        <button class="confirm-button" style="margin-right: 20px;" type="submit">Si</button>
        <button onclick="cancelConfirmLayer()" class="confirm-button" id="annulla" type="submit">No</button>
        <br><br><br>
    </div>
</div>

<!--DIV DETTAGLIO FATTURA-->
<div id="div-detail" style="display: none; ">
    <div class="form-container">
        <div class="action">
            <span class="title">Dettaglio Fattura</span>
            <button id="x-icon" onclick="toggleLayerX()"><i class="fas fa-times" ></i></button>
            <button onclick="window.printDiv('div-detail')" class="print"><i class="fas fa-print"></i></button>
        </div>
        <div class="fattura">
            <div class="row testa">
                <div class="col-6 col-sm-6 col-md-6 col-lg-6 logo">
                    <img src="../../../assets/logo-fatture.png" alt="">
                </div>
                <div class="col-6 col-sm-6 col-md-6 col-lg-6 info">
                    Ragione Sociale:<br> <b>{{invoiceDetail?.accountholder}}</b> <br> Partita IVA:<br> <b>{{currentUser?.ivaCode}}</b><br> Sede Spedizione:<br> <b>{{currentUser?.address}}</b>
                </div>
            </div>
            <div class="row">
                <div class="col-6 col-sm-6 col-md-6 col-lg-6 rif">
                    <table class="table" style="width: 76%;">
                        <tr class="tr">
                            <td class="th">Numero</td>
                            <td class="th">Data</td>
                        </tr>
                        <tr class="tr">
                            <td class="td">{{invoiceDetail?.id}}</td>
                            <td class="td">{{invoiceDetail?.date}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                    <table class="table">
                        <tr class="tr" style="width: 100%;">
                            <td colspan="9">Riepilogo generale</td>
                        </tr>
                        <tr class="tr">
                            <td class="th">Nome Articolo</td>
                            <td class="th">Prezzo Unitario</td>
                            <td class="th">Quantità</td>
                            <td class="th">Sconto (%)</td>
                            <td class="th">Totale Sconto</td>
                            <td class="th">Prezzo scontato Singolo</td>
                            <td class="th">Imponibile</td>
                            <td class="th">Tasse</td>
                            <td class="th">Totale</td>
                        </tr>
                        <tr *ngFor="let row of invoiceDetail?.rows" class="tr">
                            <td class="td">{{row.item.description}}</td>
                            <td class="td">{{row.item.price}}</td>
                            <td class="td">{{row.quantity}}</td>
                            <td class="td">{{row.percDiscount}}</td>
                            <td class="td">{{row.netPrice}}</td>
                            <td class="td">{{row.item.id}}</td>
                            <td class="td">{{row.taxable}}</td>
                            <td class="td">{{row.taxed}}</td>
                            <td class="td">{{row.finalAmount}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                    <table class="table">
                        <tr class="tr">
                            <td class="th">Totale righe</td>
                            <td class="th">Servizi</td>
                            <td class="th">Totale Sconto righe</td>
                            <td class="th">Sconto coda(%)</td>
                            <td class="th">Valore Sconto Coda</td>
                            <td class="th">Totale sconto</td>
                            <td class="th">Imponibile</td>
                            <td class="th">Tasse</td>
                            <td class="th">Totale</td>
                        </tr>
                        <tr>
                            <td class="td">{{invoiceDetail?.tail.itemsValue}}</td>
                            <td class="td">{{invoiceDetail?.tail.serviceValue}}</td>
                            <td class="td">{{invoiceDetail?.tail.rowsDiscount}}</td>
                            <td class="td">{{invoiceDetail?.tail.discountPerc}}</td>
                            <td class="td">{{invoiceDetail?.tail.discountValue}}</td>
                            <td class="td">{{invoiceDetail?.tail.totDiscount}}</td>
                            <td class="td">{{invoiceDetail?.tail.taxable}}</td>
                            <td class="td">{{invoiceDetail?.tail.taxed}}</td>
                            <td class="td">{{invoiceDetail?.tail.finalAmount}}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>